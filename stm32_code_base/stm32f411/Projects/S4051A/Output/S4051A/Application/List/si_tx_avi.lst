###############################################################################
#                                                                             #
# IAR ANSI C/C++ Compiler V6.30.1.53127/W32 for ARM     11/Nov/2014  19:23:55 #
# Copyright 1999-2011 IAR Systems AB.                                         #
#                                                                             #
#    Cpu mode     =  thumb                                                    #
#    Endian       =  little                                                   #
#    Source file  =  C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Libraries\AMT_Drivers\sii953x\component\tx\si_tx_avi. #
#                    c                                                        #
#    Command line =  C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Libraries\AMT_Drivers\sii953x\component\tx\si_tx_avi. #
#                    c -D S4051A -D DEBUG -D FREE_RTOS -D STM32F40_41xxx -D   #
#                    USE_STM324xG_EVAL -D USE_STDPERIPH_DRIVER -D             #
#                    __ARM_CORTEX_MX__ -D IAR_ARM_CM4F -D USE_USB_OTG_FS      #
#                    -lcN C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\De #
#                    vCode\2\Projects\S4051A\EWARM\..\Output\S4051A\Applicati #
#                    on\List\ -o C:\Users\tony.tsou\Desktop\AmTRAN\Projects\1 #
#                    5_K2\DevCode\2\Projects\S4051A\EWARM\..\Output\S4051A\Ap #
#                    plication\Obj\ --debug --endian=little --cpu=Cortex-M4   #
#                    -e --fpu=VFPv4_sp --dlib_config "C:\Program Files        #
#                    (x86)\IAR Systems\Embedded Workbench                     #
#                    6.0\arm\INC\c\DLib_Config_Normal.h" -I                   #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\inc\ -I                         #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\App_SRC\ -I                  #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\App_SRC\Include\ -I          #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\App_SRC\SERVICES\ -I         #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\App_SRC\SERVICES\USB_HD\inc\ #
#                     -I C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\Dev #
#                    Code\2\Projects\S4051A\EWARM\..\App_SRC\SERVICES\USB_HD\ #
#                    src\ -I C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2 #
#                    \DevCode\2\Projects\S4051A\EWARM\..\App_SRC\SERVICES\wav #
#                    ePlayer\ -I C:\Users\tony.tsou\Desktop\AmTRAN\Projects\1 #
#                    5_K2\DevCode\2\Projects\S4051A\EWARM\..\App_SRC\Managers #
#                    \ -I C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\De #
#                    vCode\2\Projects\S4051A\EWARM\..\App_SRC\Dispatchers\    #
#                    -I C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevC #
#                    ode\2\Projects\S4051A\EWARM\..\..\..\Libraries\CMSIS\Inc #
#                    lude\ -I C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K #
#                    2\DevCode\2\Projects\S4051A\EWARM\..\..\..\Libraries\CMS #
#                    IS\Device\ST\STM32F4xx\Include\ -I                       #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\STM32F4xx_St #
#                    dPeriph_Driver\inc\ -I C:\Users\tony.tsou\Desktop\AmTRAN #
#                    \Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\..\.. #
#                    \Libraries\FreeRTOS\Source\portable\IAR\ARM_CM4F\ -I     #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\FreeRTOS\Sou #
#                    rce\include\ -I C:\Users\tony.tsou\Desktop\AmTRAN\Projec #
#                    ts\15_K2\DevCode\2\Projects\S4051A\EWARM\..\..\..\Librar #
#                    ies\FreeRTOS\Source\ -I C:\Users\tony.tsou\Desktop\AmTRA #
#                    N\Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\..\. #
#                    .\Libraries\STM32_USB_OTG_Driver\inc\ -I                 #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\STM32_USB_De #
#                    vice_Library\Core\inc\ -I C:\Users\tony.tsou\Desktop\AmT #
#                    RAN\Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\.. #
#                    \..\Libraries\STM32_USB_Device_Library\Class\cdc\inc\    #
#                    -I C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevC #
#                    ode\2\Projects\S4051A\EWARM\..\..\..\Libraries\STM32_USB #
#                    _HOST_Library\Core\inc\ -I C:\Users\tony.tsou\Desktop\Am #
#                    TRAN\Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\. #
#                    .\..\Libraries\STM32_USB_HOST_Library\Class\MSC\inc\ -I  #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Utilities\Third_Party\ #
#                    efsl\inc\ -I C:\Users\tony.tsou\Desktop\AmTRAN\Projects\ #
#                    15_K2\DevCode\2\Projects\S4051A\EWARM\..\..\..\Utilities #
#                    \Third_Party\fat_fs\inc\ -I                              #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Utilities\mainstream_v #
#                    1\stm32f411\ -I C:\Users\tony.tsou\Desktop\AmTRAN\Projec #
#                    ts\15_K2\DevCode\2\Projects\S4051A\EWARM\..\..\..\Utilit #
#                    ies\mainstream_v1\stm32f411\it\ -I                       #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    EXT_FLASH\ -I C:\Users\tony.tsou\Desktop\AmTRAN\Projects #
#                    \15_K2\DevCode\2\Projects\S4051A\EWARM\..\..\..\Librarie #
#                    s\AMT_Drivers\TAS5727\ -I C:\Users\tony.tsou\Desktop\AmT #
#                    RAN\Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\.. #
#                    \..\Libraries\AMT_Drivers\TAS5711\ -I                    #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    TAS5707\ -I C:\Users\tony.tsou\Desktop\AmTRAN\Projects\1 #
#                    5_K2\DevCode\2\Projects\S4051A\EWARM\..\..\..\Libraries\ #
#                    AMT_Drivers\TAS5713\ -I C:\Users\tony.tsou\Desktop\AmTRA #
#                    N\Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\..\. #
#                    .\Libraries\AMT_Drivers\CS49844\ -I                      #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    CS8422\ -I C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15 #
#                    _K2\DevCode\2\Projects\S4051A\EWARM\..\..\..\Libraries\A #
#                    MT_Drivers\CS5346\ -I C:\Users\tony.tsou\Desktop\AmTRAN\ #
#                    Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\..\..\ #
#                    Libraries\AMT_Drivers\OTI3368\ -I                        #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    HT68F30\ -I C:\Users\tony.tsou\Desktop\AmTRAN\Projects\1 #
#                    5_K2\DevCode\2\Projects\S4051A\EWARM\..\..\..\Libraries\ #
#                    AMT_Drivers\BTM640\ -I C:\Users\tony.tsou\Desktop\AmTRAN #
#                    \Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\..\.. #
#                    \Libraries\AMT_Drivers\sii953x\application\ -I           #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\application\app_ipv\ -I                          #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\application\app_cbus\ -I                         #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\application\app_cdc\ -I                          #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\application\app_cec\ -I                          #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\application\app_arc\ -I                          #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\application\app_diag\ -I                         #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\application\app_msw\ -I                          #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\application\app_osd\ -I                          #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\component\ -I C:\Users\tony.tsou\Desktop\AmTRAN\ #
#                    Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\..\..\ #
#                    Libraries\AMT_Drivers\sii953x\component\tx\ -I           #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\component\repeater_avr\ -I                       #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\component\video_tables\ -I                       #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\component\audio_rx\ -I                           #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\component\edid_tx\ -I                            #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\component\debugger_hdmigear\ -I                  #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\component\cbus\ -I C:\Users\tony.tsou\Desktop\Am #
#                    TRAN\Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\. #
#                    .\..\Libraries\AMT_Drivers\sii953x\component\rtpi\ -I    #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\component\cdc\ -I C:\Users\tony.tsou\Desktop\AmT #
#                    RAN\Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\.. #
#                    \..\Libraries\AMT_Drivers\sii953x\component\cec_manager\ #
#                     -I C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\Dev #
#                    Code\2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Driv #
#                    ers\sii953x\component\thx\ -I                            #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\component\ipv\ -I C:\Users\tony.tsou\Desktop\AmT #
#                    RAN\Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\.. #
#                    \..\Libraries\AMT_Drivers\sii953x\component\osd\ -I      #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\component\cec_switch\ -I                         #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\component\cec_system_audio_control\ -I           #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\driver\ -I C:\Users\tony.tsou\Desktop\AmTRAN\Pro #
#                    jects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\..\..\Lib #
#                    raries\AMT_Drivers\sii953x\driver\audio_mix_drv\ -I      #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\driver\sii953x_drv\ -I                           #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\driver\cra_drv\ -I C:\Users\tony.tsou\Desktop\Am #
#                    TRAN\Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\. #
#                    .\..\Libraries\AMT_Drivers\sii953x\driver\matrix_sw_drv\ #
#                     -I C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\Dev #
#                    Code\2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Driv #
#                    ers\sii953x\driver\nvram_sram_drv\ -I                    #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\driver\tpi_drv\ -I C:\Users\tony.tsou\Desktop\Am #
#                    TRAN\Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\. #
#                    .\..\Libraries\AMT_Drivers\sii953x\driver\audio_rx_drv\  #
#                    -I C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevC #
#                    ode\2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drive #
#                    rs\sii953x\driver\repeater_avr_drv\ -I                   #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\driver\gpio_drv\ -I                              #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\driver\tpg_drv\ -I C:\Users\tony.tsou\Desktop\Am #
#                    TRAN\Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\. #
#                    .\..\Libraries\AMT_Drivers\sii953x\driver\cbus_drv\ -I   #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\driver\cpi_drv\ -I C:\Users\tony.tsou\Desktop\Am #
#                    TRAN\Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\. #
#                    .\..\Libraries\AMT_Drivers\sii953x\driver\arc_drv\ -I    #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\driver\osd_drv\ -I C:\Users\tony.tsou\Desktop\Am #
#                    TRAN\Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\. #
#                    .\..\Libraries\AMT_Drivers\sii953x\driver\ipv_drv\ -I    #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\platform\hal\ir_remote\ -I                       #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\platform\hal\eeprom\ -I                          #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\platform\hal\timer\ -I                           #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\platform\hal\i2c\ -I                             #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\platform\osal\timer\ -I                          #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\platform\board\ -Ohz -I "C:\Program Files        #
#                    (x86)\IAR Systems\Embedded Workbench                     #
#                    6.0\arm\CMSIS\Include\"                                  #
#    List file    =  C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\Output\S4051A\Application\Li #
#                    st\si_tx_avi.lst                                         #
#    Object file  =  C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\Output\S4051A\Application\Ob #
#                    j\si_tx_avi.o                                            #
#                                                                             #
#                                                                             #
###############################################################################

C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode\2\Libraries\AMT_Drivers\sii953x\component\tx\si_tx_avi.c
      1          //************************************************************************************************
      2          //! @file   si_tx_avi.c
      3          //! @brief  Auxiliary Video Info frame control
      4          //
      5          // No part of this work may be reproduced, modified, distributed,
      6          // transmitted, transcribed, or translated into any language or computer
      7          // format, in any form or by any means without written permission of
      8          // Silicon Image, Inc., 1060 East Arques Avenue, Sunnyvale, California 94085
      9          //
     10          // Copyright 2002-2010, Silicon Image, Inc.  All rights reserved.
     11          //************************************************************************************************/
     12          
     13          #include <string.h>
     14          #include "si_tx_component_internal.h"
     15          #include "si_tx_info_frm.h"
     16          #include "si_tx_avi.h"
     17          
     18          
     19          //-------------------------------------------------------------------------------------------------
     20          // Module Instance Data
     21          //-------------------------------------------------------------------------------------------------
     22          
     23          txAviInstRec_t AviInstRec[SII_NUM_TX];
     24          txAviInstRec_t *pAvi = &AviInstRec[0];
     25          
     26          
     27          //-------------------------------------------------------------------------------------------------
     28          //  Local service functions
     29          //-------------------------------------------------------------------------------------------------
     30          
     31          
     32          //-------------------------------------------------------------------------------------------------
     33          //  AVI API functions
     34          //-------------------------------------------------------------------------------------------------
     35          
     36          //-------------------------------------------------------------------------------------------------
     37          //! @brief      Select Tx device instance in multi-transmitter system.
     38          //!
     39          //! @param[in]  device_idx - zero based index of an instance.
     40          //-------------------------------------------------------------------------------------------------
     41          
     42          #if SII_NUM_TX > 1
     43          void TxAviInstanceSet(uint8_t deviceIndex)
     44          {
     45          	if(deviceIndex < SII_NUM_TX)
     46          	{
     47          		pAvi = &AviInstRec[deviceIndex];
     48          	}
     49          }
     50          #endif // SII_NUM_TX > 1
     51          
     52          
     53          //-------------------------------------------------------------------------------------------------
     54          //! @brief      Initialization of TX AVI module.
     55          //-------------------------------------------------------------------------------------------------
     56          
     57          void TxAviInit(void)
     58          {
     59              memset(pAvi, 0, sizeof(AviInstRec[0]));
     60          }
     61          
     62          
     63          //-------------------------------------------------------------------------------------------------
     64          //! @brief      Submit AVI packet (header + info frame) into TX chip.
     65          //-------------------------------------------------------------------------------------------------
     66          
     67          void TxAviPostAviPacket(void)
     68          {
     69          	uint8_t aviPacket[IF_MAX_AVI_LENGTH + IF_HEADER_LENGTH];
     70          
     71          	memset(aviPacket, 0, sizeof(aviPacket));
     72          
     73          	aviPacket[IF_TITLE_INDEX] = SI_INFO_FRAME_AVI;
     74          	aviPacket[IF_VERSION_INDEX] = 2;
     75          	aviPacket[IF_LENGTH_INDEX] = IF_MIN_AVI_LENGTH;
     76          	aviPacket[IF_CHECKSUM_INDEX] = 0; // to be filled inside TxInfoPacketSet() function
     77          
     78          	aviPacket[IF_DATA_INDEX + 0] = pAvi->dataByte1 & (~0x0C);// clear Bar Info field
     79          	aviPacket[IF_DATA_INDEX + 1] = pAvi->dataByte2;
     80          	aviPacket[IF_DATA_INDEX + 2] = pAvi->dataByte3;
     81          	aviPacket[IF_DATA_INDEX + 3] = pAvi->dataByte4;
     82          	aviPacket[IF_DATA_INDEX + 4] = pAvi->dataByte5;
     83          
     84          	TxInfoPacketSet(SI_INFO_FRAME_AVI, aviPacket);
     85          }
     86          
     87          //-------------------------------------------------------------------------------------------------
     88          //! @brief      Set color space in the AVI info frame.
     89          //-------------------------------------------------------------------------------------------------
     90          
     91          void TxAviColorSpaceSet(txVbusColSpace_t colorSpace)
     92          {
     93          	// Clear color space info
     94          	pAvi->dataByte1 &= ~0x60;
     95          
     96              // Replace with the new information
     97              switch (colorSpace)
     98              {
     99                  case SI_TX_VBUS_COLOR_SPACE_YCBCR422:
    100                      pAvi->dataByte1 |= 0x20; // color space- YCbCr 4:2:2
    101                      break;
    102          
    103                  case SI_TX_VBUS_COLOR_SPACE_YCBCR444:
    104                      pAvi->dataByte1 |= 0x40; // color space- YCbCr 4:4:4
    105                      break;
    106          
    107                  case SI_TX_VBUS_COLOR_SPACE_RGB:
    108                      pAvi->dataByte1 |= 0; // RGB color space
    109                      break;
    110              }
    111          
    112          }
    113          
    114          
    115          //-------------------------------------------------------------------------------------------------
    116          //! @brief      Return color space id extracted from the AVI info frame.
    117          //-------------------------------------------------------------------------------------------------
    118          
    119          txVbusColSpace_t TxAviColorSpaceGet(void)
    120          {
    121              txVbusColSpace_t colSpace;
    122          
    123              switch ((pAvi->dataByte1 >> 5) & 0x03)
    124              {
    125                  default:
    126                  case 0:
    127                      colSpace = SI_TX_VBUS_COLOR_SPACE_RGB;
    128                      break;
    129                  case 1:
    130                      colSpace = SI_TX_VBUS_COLOR_SPACE_YCBCR422;
    131                      break;
    132                  case 2:
    133                      colSpace = SI_TX_VBUS_COLOR_SPACE_YCBCR444;
    134                      break;
    135              }
    136          
    137          	return colSpace;
    138          }
    139          
    140          
    141          //-------------------------------------------------------------------------------------------------
    142          //! @brief      Return repetition factor extracted from the AVI info frame.
    143          //-------------------------------------------------------------------------------------------------
    144          
    145          uint8_t TxAviRepetitionGet(uint8_t videoIndex)
    146          {
    147          	return
    148          		((pAvi->dataByte4) & 0x7F) ? // if VIC != 0
    149          		((pAvi->dataByte5) & 0x0F) : // use AVI repetition field
    150          		SiiVideoTableRepetitionGet(videoIndex); // get repetition from the table
    151          }
    152          
    153          
    154          //-------------------------------------------------------------------------------------------------
    155          //! @brief      Return colorimetry type extracted from the AVI info frame.
    156          //-------------------------------------------------------------------------------------------------
    157          
    158          txVbusColorimetry_t TxAviColorimetryGet(void)
    159          {
    160              txVbusColorimetry_t colorimetry = (pAvi->dataByte2 >> 6) & 0x03;
    161          	if(colorimetry == SI_TX_VIDEO_COLORIMETRY_EXTENDED)
    162          	{
    163          		switch((pAvi->dataByte3 >> 4) & 0x07)
    164          		{
    165          		case 0:
    166          			colorimetry = SI_TX_VIDEO_COLORIMETRY_XV601;
    167          			break;
    168          		case 1:
    169          			colorimetry = SI_TX_VIDEO_COLORIMETRY_XV709;
    170          			break;
    171          		default:
    172          			colorimetry = SI_TX_VIDEO_COLORIMETRY_NO_INFO;
    173          		}
    174          	}
    175          	return colorimetry;
    176          }
    177          
    178          
    179          //-------------------------------------------------------------------------------------------------
    180          //! @brief      Create AVI info frame based on current video format and video bus mode.
    181          //!
    182          //! @param[in]  videoFmtIndex - current video format Id,
    183          //! @param[in]  vBusMode      - input video bus mode.
    184          //-------------------------------------------------------------------------------------------------
    185          
    186          void TxAviFrameCreate(videoFormatId_t videoFmtIndex, txVideoBusMode_t *pBusMode)
    187          {
    188              TxAviInit();
    189          
    190              if (videoFmtIndex != SI_VIDEO_MODE_NON_STD)
    191              {
    192                  const videoMode_t *pVideoMode = &(VideoModeTable[videoFmtIndex]);
    193                  uint8_t vic_4x3 = pVideoMode->Vic4x3;
    194                  uint8_t vic_16x9 = pVideoMode->Vic16x9;
    195          
    196                  // VIC and Aspect Ratio
    197                  // VIC for 3D modes corresponds to one of 2D pictures (see p.136 of HDMI spec)
    198                  if (vic_4x3)
    199                  {
    200                      pAvi->dataByte4 = vic_4x3;  // video code
    201                      pAvi->dataByte2 = 0x18;     // aspect ratio- 4:3
    202                  }
    203                  else if (vic_16x9)
    204                  {
    205                      pAvi->dataByte4 = vic_16x9; // video code
    206                      pAvi->dataByte2 = 0x28;     // aspect ratio- 16:9
    207                  }
    208                  else
    209                  {
    210                      pAvi->dataByte2 = 0x08;     // aspect ratio- No Data
    211                  }
    212          
    213                  // Colorimetry
    214                  switch (VideoModeTable[videoFmtIndex].Active.V)
    215                  {
    216                      case 480:
    217                      case 576:
    218                      case 240:
    219                      case 288:
    220                          pAvi->dataByte2 |= 0x40; // colorimetry ITU601
    221                          break;
    222                      default:
    223                          pAvi->dataByte2 |= 0x80; // colorimetry ITU709
    224                  }
    225          
    226                  // Pixel repetition factor
    227                  pAvi->dataByte5 = SiiVideoTableRepetitionGet(videoFmtIndex);
    228              }
    229              else  // The case of non-standard video
    230              {
    231                  // VIC must be 0 for non-standard video modes
    232                  // Aspect Ratio - no data
    233                  pAvi->dataByte2 = 0x08;
    234          
    235                  // Colorimetry
    236                  switch (pBusMode->colorimetry)
    237                  {
    238                      case SI_TX_VIDEO_COLORIMETRY_ITU601:
    239                      case SI_TX_VIDEO_COLORIMETRY_XV601:
    240                          pAvi->dataByte2 |= 0x40;
    241                          break;
    242          
    243                      case SI_TX_VIDEO_COLORIMETRY_ITU709:
    244                      case SI_TX_VIDEO_COLORIMETRY_XV709:
    245                          pAvi->dataByte2 |= 0x80;
    246                          break;
    247          
    248                      case SI_TX_VIDEO_COLORIMETRY_EXTENDED:
    249                          pAvi->dataByte2 |= 0xc0;
    250                          break;
    251          
    252                      default:
    253                          pAvi->dataByte2 |= 0x0;
    254                          break;
    255                  }
    256          
    257                  // Pixel Repetition factor
    258                  pAvi->dataByte5 = pBusMode->pixelRepetition;
    259              }
    260          
    261              // Color space indication
    262              TxAviColorSpaceSet(pBusMode->colorSpace);
    263          }
    264          
    265          

   Maximum stack usage in bytes:

   .cstack Function
   ------- --------
        0  TxAviColorSpaceGet
        0  TxAviColorSpaceSet
        0  TxAviColorimetryGet
       16  TxAviFrameCreate
             16 -> SiiVideoTableRepetitionGet
              0 -> TxAviColorSpaceSet
             16 -> TxAviInit
        0  TxAviInit
              0 -> __aeabi_memclr
       24  TxAviPostAviPacket
             24 -> TxInfoPacketSet
             24 -> __aeabi_memclr4
        0  TxAviRepetitionGet
              0 -> SiiVideoTableRepetitionGet


   Section sizes:

   Bytes  Function/Label
   -----  --------------
       4  ??DataTable6
       4  ??DataTable6_1
       8  AviInstRec
      32  TxAviColorSpaceGet
      40  TxAviColorSpaceSet
      40  TxAviColorimetryGet
     170  TxAviFrameCreate
      10  TxAviInit
      80  TxAviPostAviPacket
      24  TxAviRepetitionGet
       4  pAvi

 
   8 bytes in section .bss
   4 bytes in section .data
 404 bytes in section .text
 
 404 bytes of CODE memory
  12 bytes of DATA memory

Errors: none
Warnings: 2
