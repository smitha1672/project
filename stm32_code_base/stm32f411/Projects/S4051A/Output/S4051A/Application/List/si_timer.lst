###############################################################################
#                                                                             #
# IAR ANSI C/C++ Compiler V6.30.1.53127/W32 for ARM     11/Nov/2014  19:23:41 #
# Copyright 1999-2011 IAR Systems AB.                                         #
#                                                                             #
#    Cpu mode     =  thumb                                                    #
#    Endian       =  little                                                   #
#    Source file  =  C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Libraries\AMT_Drivers\sii953x\platform\hal\timer\si_t #
#                    imer.c                                                   #
#    Command line =  C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Libraries\AMT_Drivers\sii953x\platform\hal\timer\si_t #
#                    imer.c -D S4051A -D DEBUG -D FREE_RTOS -D                #
#                    STM32F40_41xxx -D USE_STM324xG_EVAL -D                   #
#                    USE_STDPERIPH_DRIVER -D __ARM_CORTEX_MX__ -D             #
#                    IAR_ARM_CM4F -D USE_USB_OTG_FS -lcN                      #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\Output\S4051A\Application\Li #
#                    st\ -o C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\ #
#                    DevCode\2\Projects\S4051A\EWARM\..\Output\S4051A\Applica #
#                    tion\Obj\ --debug --endian=little --cpu=Cortex-M4 -e     #
#                    --fpu=VFPv4_sp --dlib_config "C:\Program Files           #
#                    (x86)\IAR Systems\Embedded Workbench                     #
#                    6.0\arm\INC\c\DLib_Config_Normal.h" -I                   #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\inc\ -I                         #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\App_SRC\ -I                  #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\App_SRC\Include\ -I          #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\App_SRC\SERVICES\ -I         #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\App_SRC\SERVICES\USB_HD\inc\ #
#                     -I C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\Dev #
#                    Code\2\Projects\S4051A\EWARM\..\App_SRC\SERVICES\USB_HD\ #
#                    src\ -I C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2 #
#                    \DevCode\2\Projects\S4051A\EWARM\..\App_SRC\SERVICES\wav #
#                    ePlayer\ -I C:\Users\tony.tsou\Desktop\AmTRAN\Projects\1 #
#                    5_K2\DevCode\2\Projects\S4051A\EWARM\..\App_SRC\Managers #
#                    \ -I C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\De #
#                    vCode\2\Projects\S4051A\EWARM\..\App_SRC\Dispatchers\    #
#                    -I C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevC #
#                    ode\2\Projects\S4051A\EWARM\..\..\..\Libraries\CMSIS\Inc #
#                    lude\ -I C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K #
#                    2\DevCode\2\Projects\S4051A\EWARM\..\..\..\Libraries\CMS #
#                    IS\Device\ST\STM32F4xx\Include\ -I                       #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\STM32F4xx_St #
#                    dPeriph_Driver\inc\ -I C:\Users\tony.tsou\Desktop\AmTRAN #
#                    \Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\..\.. #
#                    \Libraries\FreeRTOS\Source\portable\IAR\ARM_CM4F\ -I     #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\FreeRTOS\Sou #
#                    rce\include\ -I C:\Users\tony.tsou\Desktop\AmTRAN\Projec #
#                    ts\15_K2\DevCode\2\Projects\S4051A\EWARM\..\..\..\Librar #
#                    ies\FreeRTOS\Source\ -I C:\Users\tony.tsou\Desktop\AmTRA #
#                    N\Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\..\. #
#                    .\Libraries\STM32_USB_OTG_Driver\inc\ -I                 #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\STM32_USB_De #
#                    vice_Library\Core\inc\ -I C:\Users\tony.tsou\Desktop\AmT #
#                    RAN\Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\.. #
#                    \..\Libraries\STM32_USB_Device_Library\Class\cdc\inc\    #
#                    -I C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevC #
#                    ode\2\Projects\S4051A\EWARM\..\..\..\Libraries\STM32_USB #
#                    _HOST_Library\Core\inc\ -I C:\Users\tony.tsou\Desktop\Am #
#                    TRAN\Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\. #
#                    .\..\Libraries\STM32_USB_HOST_Library\Class\MSC\inc\ -I  #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Utilities\Third_Party\ #
#                    efsl\inc\ -I C:\Users\tony.tsou\Desktop\AmTRAN\Projects\ #
#                    15_K2\DevCode\2\Projects\S4051A\EWARM\..\..\..\Utilities #
#                    \Third_Party\fat_fs\inc\ -I                              #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Utilities\mainstream_v #
#                    1\stm32f411\ -I C:\Users\tony.tsou\Desktop\AmTRAN\Projec #
#                    ts\15_K2\DevCode\2\Projects\S4051A\EWARM\..\..\..\Utilit #
#                    ies\mainstream_v1\stm32f411\it\ -I                       #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    EXT_FLASH\ -I C:\Users\tony.tsou\Desktop\AmTRAN\Projects #
#                    \15_K2\DevCode\2\Projects\S4051A\EWARM\..\..\..\Librarie #
#                    s\AMT_Drivers\TAS5727\ -I C:\Users\tony.tsou\Desktop\AmT #
#                    RAN\Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\.. #
#                    \..\Libraries\AMT_Drivers\TAS5711\ -I                    #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    TAS5707\ -I C:\Users\tony.tsou\Desktop\AmTRAN\Projects\1 #
#                    5_K2\DevCode\2\Projects\S4051A\EWARM\..\..\..\Libraries\ #
#                    AMT_Drivers\TAS5713\ -I C:\Users\tony.tsou\Desktop\AmTRA #
#                    N\Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\..\. #
#                    .\Libraries\AMT_Drivers\CS49844\ -I                      #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    CS8422\ -I C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15 #
#                    _K2\DevCode\2\Projects\S4051A\EWARM\..\..\..\Libraries\A #
#                    MT_Drivers\CS5346\ -I C:\Users\tony.tsou\Desktop\AmTRAN\ #
#                    Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\..\..\ #
#                    Libraries\AMT_Drivers\OTI3368\ -I                        #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    HT68F30\ -I C:\Users\tony.tsou\Desktop\AmTRAN\Projects\1 #
#                    5_K2\DevCode\2\Projects\S4051A\EWARM\..\..\..\Libraries\ #
#                    AMT_Drivers\BTM640\ -I C:\Users\tony.tsou\Desktop\AmTRAN #
#                    \Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\..\.. #
#                    \Libraries\AMT_Drivers\sii953x\application\ -I           #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\application\app_ipv\ -I                          #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\application\app_cbus\ -I                         #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\application\app_cdc\ -I                          #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\application\app_cec\ -I                          #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\application\app_arc\ -I                          #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\application\app_diag\ -I                         #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\application\app_msw\ -I                          #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\application\app_osd\ -I                          #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\component\ -I C:\Users\tony.tsou\Desktop\AmTRAN\ #
#                    Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\..\..\ #
#                    Libraries\AMT_Drivers\sii953x\component\tx\ -I           #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\component\repeater_avr\ -I                       #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\component\video_tables\ -I                       #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\component\audio_rx\ -I                           #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\component\edid_tx\ -I                            #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\component\debugger_hdmigear\ -I                  #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\component\cbus\ -I C:\Users\tony.tsou\Desktop\Am #
#                    TRAN\Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\. #
#                    .\..\Libraries\AMT_Drivers\sii953x\component\rtpi\ -I    #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\component\cdc\ -I C:\Users\tony.tsou\Desktop\AmT #
#                    RAN\Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\.. #
#                    \..\Libraries\AMT_Drivers\sii953x\component\cec_manager\ #
#                     -I C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\Dev #
#                    Code\2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Driv #
#                    ers\sii953x\component\thx\ -I                            #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\component\ipv\ -I C:\Users\tony.tsou\Desktop\AmT #
#                    RAN\Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\.. #
#                    \..\Libraries\AMT_Drivers\sii953x\component\osd\ -I      #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\component\cec_switch\ -I                         #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\component\cec_system_audio_control\ -I           #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\driver\ -I C:\Users\tony.tsou\Desktop\AmTRAN\Pro #
#                    jects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\..\..\Lib #
#                    raries\AMT_Drivers\sii953x\driver\audio_mix_drv\ -I      #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\driver\sii953x_drv\ -I                           #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\driver\cra_drv\ -I C:\Users\tony.tsou\Desktop\Am #
#                    TRAN\Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\. #
#                    .\..\Libraries\AMT_Drivers\sii953x\driver\matrix_sw_drv\ #
#                     -I C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\Dev #
#                    Code\2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Driv #
#                    ers\sii953x\driver\nvram_sram_drv\ -I                    #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\driver\tpi_drv\ -I C:\Users\tony.tsou\Desktop\Am #
#                    TRAN\Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\. #
#                    .\..\Libraries\AMT_Drivers\sii953x\driver\audio_rx_drv\  #
#                    -I C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevC #
#                    ode\2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drive #
#                    rs\sii953x\driver\repeater_avr_drv\ -I                   #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\driver\gpio_drv\ -I                              #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\driver\tpg_drv\ -I C:\Users\tony.tsou\Desktop\Am #
#                    TRAN\Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\. #
#                    .\..\Libraries\AMT_Drivers\sii953x\driver\cbus_drv\ -I   #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\driver\cpi_drv\ -I C:\Users\tony.tsou\Desktop\Am #
#                    TRAN\Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\. #
#                    .\..\Libraries\AMT_Drivers\sii953x\driver\arc_drv\ -I    #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\driver\osd_drv\ -I C:\Users\tony.tsou\Desktop\Am #
#                    TRAN\Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\. #
#                    .\..\Libraries\AMT_Drivers\sii953x\driver\ipv_drv\ -I    #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\platform\hal\ir_remote\ -I                       #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\platform\hal\eeprom\ -I                          #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\platform\hal\timer\ -I                           #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\platform\hal\i2c\ -I                             #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\platform\osal\timer\ -I                          #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\platform\board\ -Ohz -I "C:\Program Files        #
#                    (x86)\IAR Systems\Embedded Workbench                     #
#                    6.0\arm\CMSIS\Include\"                                  #
#    List file    =  C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\Output\S4051A\Application\Li #
#                    st\si_timer.lst                                          #
#    Object file  =  C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\Output\S4051A\Application\Ob #
#                    j\si_timer.o                                             #
#                                                                             #
#                                                                             #
###############################################################################

C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode\2\Libraries\AMT_Drivers\sii953x\platform\hal\timer\si_timer.c
      1          //***************************************************************************
      2          //!file     si_timer.c
      3          //!brief    Platform timer system, ARM (Stellaris) version.
      4          //
      5          // No part of this work may be reproduced, modified, distributed,
      6          // transmitted, transcribed, or translated into any language or computer
      7          // format, in any form or by any means without written permission of
      8          // Silicon Image, Inc., 1060 East Arques Avenue, Sunnyvale, California 94085
      9          //
     10          // Copyright 2010, Silicon Image, Inc.  All rights reserved.
     11          //***************************************************************************/
     12          
     13          #include "si_common.h"
     14          #include "si_platform.h"
     15          #include "si_timer.h"
     16          
     17          #if defined ( SII_DEV_953x_PORTING_PLATFORM_LM3S5956 )
     18          #include "si_arm.h"
     19          #endif 
     20          
     21          
     22          #if ( configRTOS_TIMER == 1 )
     23          #define MIN_BLOCK_TIME(x)		(x/portTICK_PERIOD_MS)
     24          
     25          #endif 
     26          
     27          volatile unsigned long g_ulTickCounter = 0;
     28          
     29          //------------------------------------------------------------------------------
     30          // Array of timer values
     31          //------------------------------------------------------------------------------
     32          
     33          static volatile uint16_t gTimerCounters[ TIMER_COUNT ];
     34          
     35          static volatile uint16_t gTimerElapsed;
     36          static volatile uint16_t gElapsedTick;
     37          static volatile uint16_t gTimerElapsedGranularity;
     38          
     39          static volatile uint16_t gTimerElapsed1;
     40          static volatile uint16_t gElapsedTick1;
     41          static volatile uint16_t gTimerElapsedGranularity1;
     42          
     43          #if ( configRTOS_TIMER == 1 )
     44          xTimerHandle xSiTimer = NULL;
     45          #endif 
     46          
     47          
     48          //*****************************************************************************
     49          //
     50          // The interrupt handler for the SysTick interrupt.
     51          //
     52          //*****************************************************************************
     53          
     54          #if ( configRTOS_TIMER == 1 )
     55          void SiiPlatformTimerSysTickIntHandler ( TimerHandle_t pxTimer )
     56          
     57          #else
     58          void SiiPlatformTimerSysTickIntHandler (void)
     59          #endif 
     60          {
     61              int             i;
     62              unsigned long   ulInt;
     63          
     64          #if defined ( SII_DEV_953x_PORTING_PLATFORM_LM3S5956 )
     65              ulInt = ROM_IntMasterDisable(); // Temporarily turn off interrupts.
     66          #endif 
     67          
     68              g_ulTickCounter++;              // Increment the system tick count.
     69          
     70              // Decrement all active timers in array
     71          
     72              for ( i = 0; i < TIMER_COUNT; i++ )
     73              {
     74                  if ( gTimerCounters[ i ] > 0 )
     75                  {
     76                      gTimerCounters[ i ]--;
     77                  }
     78              }
     79              gElapsedTick++;
     80              if ( gElapsedTick == gTimerElapsedGranularity )
     81              {
     82                  gTimerElapsed++;
     83                  gElapsedTick = 0;
     84              }
     85              gElapsedTick1++;
     86              if ( gElapsedTick1 == gTimerElapsedGranularity1 )
     87              {
     88                  gTimerElapsed1++;
     89                  gElapsedTick1 = 0;
     90              }
     91          
     92              if ( !ulInt )   // Re-enable interrupts if needed
     93              {
     94          #if defined ( SII_DEV_953x_PORTING_PLATFORM_LM3S5956 )
     95                  ROM_IntMasterEnable();
     96          #endif         
     97              }
     98          
     99          }
    100          
    101          //------------------------------------------------------------------------------
    102          // Function:    SiiPlatformTimerSysTicksGet
    103          // Description: Returns the current number of system ticks since we started
    104          // Parameters:
    105          // Returns:
    106          //------------------------------------------------------------------------------
    107          
    108          clock_time_t SiiPlatformTimerSysTicksGet (void)
    109          {
    110              return((clock_time_t)g_ulTickCounter);
    111          }
    112          
    113          //------------------------------------------------------------------------------
    114          // Function:    SiiPlatformTimerSet
    115          // Description:
    116          //------------------------------------------------------------------------------
    117          
    118          void SiiPlatformTimerSet ( uint8_t index, uint16_t m_sec )
    119          {
    120          #if defined ( SII_DEV_953x_PORTING_PLATFORM_LM3S5956_TIMER )
    121              ROM_SysTickIntDisable();
    122          #endif
    123          
    124              switch ( index )
    125              {
    126              case TIMER_0:
    127              case TIMER_1:
    128              case TIMER_2:
    129              case TIMER_3:
    130              case TIMER_4:
    131                  gTimerCounters[ index ] = m_sec;
    132                  break;
    133          
    134              case ELAPSED_TIMER:
    135                  gTimerElapsedGranularity = m_sec;
    136                  gTimerElapsed = 0;
    137                  gElapsedTick = 0;
    138                  break;
    139              case ELAPSED_TIMER1:
    140                  gTimerElapsedGranularity1 = m_sec;
    141                  gTimerElapsed1 = 0;
    142                  gElapsedTick1 = 0;
    143                  break;
    144              }
    145              
    146          #if defined ( SII_DEV_953x_PORTING_PLATFORM_LM3S5956_TIMER )
    147              ROM_SysTickIntEnable();
    148          #endif
    149          
    150          }
    151          
    152          //------------------------------------------------------------------------------
    153          // Function:    SiiPlatformTimerExpired
    154          // Description: Returns > 0 if specified timer has expired.
    155          //------------------------------------------------------------------------------
    156          
    157          uint8_t SiiPlatformTimerExpired ( uint8_t timer )
    158          {
    159              if ( timer < TIMER_COUNT )
    160              {
    161                  return( gTimerCounters[ timer ] == 0);
    162              }
    163          
    164              return( 0 );
    165          }
    166          
    167          //------------------------------------------------------------------------------
    168          // Function:    SiiPlatformTimerElapsed
    169          // Description: Returns current timer tick.  Rollover depends on the
    170          //              granularity specified in the SetTimer() call.
    171          //------------------------------------------------------------------------------
    172          
    173          uint16_t SiiPlatformTimerElapsed ( uint8_t index )
    174          {
    175              uint16_t elapsedTime;
    176          
    177          #if defined ( SII_DEV_953x_PORTING_PLATFORM_LM3S5956_TIMER )
    178              ROM_SysTickIntDisable();
    179          #endif     
    180              if ( index == ELAPSED_TIMER )
    181                  elapsedTime = gTimerElapsed;
    182              else
    183                  elapsedTime = gTimerElapsed1;
    184          
    185          #if defined ( SII_DEV_953x_PORTING_PLATFORM_LM3S5956_TIMER )
    186              ROM_SysTickIntEnable();
    187          #endif 
    188          
    189              return( elapsedTime );
    190          }
    191          
    192          //------------------------------------------------------------------------------
    193          // Function:    SiiPlatformTimerWait
    194          // Description: Waits for the specified number of milliseconds, using timer 0.
    195          //------------------------------------------------------------------------------
    196          
    197          void SiiPlatformTimerWait ( uint16_t m_sec )
    198          {
    199          #if (configRTOS_TIMER == 0)
    200              SiiPlatformTimerSet( 0, m_sec );
    201              while ( !SiiPlatformTimerExpired( 0 ) )
    202              {
    203                  ;  //empty wait loop
    204              }
    205          #else
    206          	vTaskDelay( TASK_MSEC2TICKS(m_sec) );	
    207          #endif 
    208          }
    209          
    210          //------------------------------------------------------------------------------
    211          // Function:    SiiPlatformTimerInit
    212          // Description:
    213          // Parameters:
    214          // Returns:
    215          //------------------------------------------------------------------------------
    216           
    217          
    218          void SiiPlatformTimerInit (void)
    219          {
    220              int i;
    221          
    222              //initializer timer counters in array
    223          
    224              for ( i = 0; i < TIMER_COUNT; i++ )
    225              {
    226                  gTimerCounters[ i ] = 0;
    227              }
    228              gTimerElapsed  = 0;
    229              gTimerElapsed1 = 0;
    230              gElapsedTick   = 0;
    231              gElapsedTick1  = 0;
    232              gTimerElapsedGranularity   = 0;
    233              gTimerElapsedGranularity1  = 0;
    234          
    235              // Configure SysTick for a 1ms periodic interrupt.
    236          #if ( configSII_DEV_953x_PORTING == 1 ) && ( configRTOS_TIMER == 1 )
    237          	xSiTimer = xTimerCreate( ( const signed char * ) "si_timer", MIN_BLOCK_TIME(1), pdTRUE, NULL, SiiPlatformTimerSysTickIntHandler );
    238          	if ( xSiTimer != NULL )
    239          	{
    240          		xTimerStart( xSiTimer, ( portTickType ) 0 );
    241          	}
    242          #else
    243          	ROM_SysTickPeriodSet(ROM_SysCtlClockGet() / SYSTICKHZ);
    244          	ROM_SysTickEnable();
    245          	ROM_SysTickIntEnable();
    246          #endif 
    247          
    248          }
    249          

   Maximum stack usage in bytes:

   .cstack Function
   ------- --------
        0  SiiPlatformTimerElapsed
        0  SiiPlatformTimerExpired
       16  SiiPlatformTimerInit
             16 -> __aeabi_memclr4
             16 -> xTaskGetTickCount
             16 -> xTimerCreate
             16 -> xTimerGenericCommand
        0  SiiPlatformTimerSet
        0  SiiPlatformTimerSysTickIntHandler
        0  SiiPlatformTimerSysTicksGet
        0  SiiPlatformTimerWait
              0 -> vTaskDelay


   Section sizes:

   Bytes  Function/Label
   -----  --------------
      12  ?<Constant "si_timer">
       4  ??DataTable6
       4  ??DataTable6_1
      14  SiiPlatformTimerElapsed
      24  SiiPlatformTimerExpired
      74  SiiPlatformTimerInit
      46  SiiPlatformTimerSet
      80  SiiPlatformTimerSysTickIntHandler
       6  SiiPlatformTimerSysTicksGet
       4  SiiPlatformTimerWait
      32  gTimerElapsed
          gElapsedTick
          gTimerElapsedGranularity
          gTimerElapsed1
          gElapsedTick1
          gTimerElapsedGranularity1
          gTimerCounters
          g_ulTickCounter
          xSiTimer

 
  32 bytes in section .bss
 268 bytes in section .text
 
 268 bytes of CODE memory
  32 bytes of DATA memory

Errors: none
Warnings: 3
