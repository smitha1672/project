###############################################################################
#                                                                             #
# IAR ANSI C/C++ Compiler V6.30.1.53127/W32 for ARM     11/Nov/2014  19:25:22 #
# Copyright 1999-2011 IAR Systems AB.                                         #
#                                                                             #
#    Cpu mode     =  thumb                                                    #
#    Endian       =  little                                                   #
#    Source file  =  C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Libraries\AMT_Drivers\sii953x\component\thx\si_thx_co #
#                    mponent.c                                                #
#    Command line =  C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Libraries\AMT_Drivers\sii953x\component\thx\si_thx_co #
#                    mponent.c -D S4051A -D DEBUG -D FREE_RTOS -D             #
#                    STM32F40_41xxx -D USE_STM324xG_EVAL -D                   #
#                    USE_STDPERIPH_DRIVER -D __ARM_CORTEX_MX__ -D             #
#                    IAR_ARM_CM4F -D USE_USB_OTG_FS -lcN                      #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\Output\S4051A\Application\Li #
#                    st\ -o C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\ #
#                    DevCode\2\Projects\S4051A\EWARM\..\Output\S4051A\Applica #
#                    tion\Obj\ --debug --endian=little --cpu=Cortex-M4 -e     #
#                    --fpu=VFPv4_sp --dlib_config "C:\Program Files           #
#                    (x86)\IAR Systems\Embedded Workbench                     #
#                    6.0\arm\INC\c\DLib_Config_Normal.h" -I                   #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\inc\ -I                         #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\App_SRC\ -I                  #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\App_SRC\Include\ -I          #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\App_SRC\SERVICES\ -I         #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\App_SRC\SERVICES\USB_HD\inc\ #
#                     -I C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\Dev #
#                    Code\2\Projects\S4051A\EWARM\..\App_SRC\SERVICES\USB_HD\ #
#                    src\ -I C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2 #
#                    \DevCode\2\Projects\S4051A\EWARM\..\App_SRC\SERVICES\wav #
#                    ePlayer\ -I C:\Users\tony.tsou\Desktop\AmTRAN\Projects\1 #
#                    5_K2\DevCode\2\Projects\S4051A\EWARM\..\App_SRC\Managers #
#                    \ -I C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\De #
#                    vCode\2\Projects\S4051A\EWARM\..\App_SRC\Dispatchers\    #
#                    -I C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevC #
#                    ode\2\Projects\S4051A\EWARM\..\..\..\Libraries\CMSIS\Inc #
#                    lude\ -I C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K #
#                    2\DevCode\2\Projects\S4051A\EWARM\..\..\..\Libraries\CMS #
#                    IS\Device\ST\STM32F4xx\Include\ -I                       #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\STM32F4xx_St #
#                    dPeriph_Driver\inc\ -I C:\Users\tony.tsou\Desktop\AmTRAN #
#                    \Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\..\.. #
#                    \Libraries\FreeRTOS\Source\portable\IAR\ARM_CM4F\ -I     #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\FreeRTOS\Sou #
#                    rce\include\ -I C:\Users\tony.tsou\Desktop\AmTRAN\Projec #
#                    ts\15_K2\DevCode\2\Projects\S4051A\EWARM\..\..\..\Librar #
#                    ies\FreeRTOS\Source\ -I C:\Users\tony.tsou\Desktop\AmTRA #
#                    N\Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\..\. #
#                    .\Libraries\STM32_USB_OTG_Driver\inc\ -I                 #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\STM32_USB_De #
#                    vice_Library\Core\inc\ -I C:\Users\tony.tsou\Desktop\AmT #
#                    RAN\Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\.. #
#                    \..\Libraries\STM32_USB_Device_Library\Class\cdc\inc\    #
#                    -I C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevC #
#                    ode\2\Projects\S4051A\EWARM\..\..\..\Libraries\STM32_USB #
#                    _HOST_Library\Core\inc\ -I C:\Users\tony.tsou\Desktop\Am #
#                    TRAN\Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\. #
#                    .\..\Libraries\STM32_USB_HOST_Library\Class\MSC\inc\ -I  #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Utilities\Third_Party\ #
#                    efsl\inc\ -I C:\Users\tony.tsou\Desktop\AmTRAN\Projects\ #
#                    15_K2\DevCode\2\Projects\S4051A\EWARM\..\..\..\Utilities #
#                    \Third_Party\fat_fs\inc\ -I                              #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Utilities\mainstream_v #
#                    1\stm32f411\ -I C:\Users\tony.tsou\Desktop\AmTRAN\Projec #
#                    ts\15_K2\DevCode\2\Projects\S4051A\EWARM\..\..\..\Utilit #
#                    ies\mainstream_v1\stm32f411\it\ -I                       #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    EXT_FLASH\ -I C:\Users\tony.tsou\Desktop\AmTRAN\Projects #
#                    \15_K2\DevCode\2\Projects\S4051A\EWARM\..\..\..\Librarie #
#                    s\AMT_Drivers\TAS5727\ -I C:\Users\tony.tsou\Desktop\AmT #
#                    RAN\Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\.. #
#                    \..\Libraries\AMT_Drivers\TAS5711\ -I                    #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    TAS5707\ -I C:\Users\tony.tsou\Desktop\AmTRAN\Projects\1 #
#                    5_K2\DevCode\2\Projects\S4051A\EWARM\..\..\..\Libraries\ #
#                    AMT_Drivers\TAS5713\ -I C:\Users\tony.tsou\Desktop\AmTRA #
#                    N\Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\..\. #
#                    .\Libraries\AMT_Drivers\CS49844\ -I                      #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    CS8422\ -I C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15 #
#                    _K2\DevCode\2\Projects\S4051A\EWARM\..\..\..\Libraries\A #
#                    MT_Drivers\CS5346\ -I C:\Users\tony.tsou\Desktop\AmTRAN\ #
#                    Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\..\..\ #
#                    Libraries\AMT_Drivers\OTI3368\ -I                        #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    HT68F30\ -I C:\Users\tony.tsou\Desktop\AmTRAN\Projects\1 #
#                    5_K2\DevCode\2\Projects\S4051A\EWARM\..\..\..\Libraries\ #
#                    AMT_Drivers\BTM640\ -I C:\Users\tony.tsou\Desktop\AmTRAN #
#                    \Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\..\.. #
#                    \Libraries\AMT_Drivers\sii953x\application\ -I           #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\application\app_ipv\ -I                          #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\application\app_cbus\ -I                         #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\application\app_cdc\ -I                          #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\application\app_cec\ -I                          #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\application\app_arc\ -I                          #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\application\app_diag\ -I                         #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\application\app_msw\ -I                          #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\application\app_osd\ -I                          #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\component\ -I C:\Users\tony.tsou\Desktop\AmTRAN\ #
#                    Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\..\..\ #
#                    Libraries\AMT_Drivers\sii953x\component\tx\ -I           #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\component\repeater_avr\ -I                       #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\component\video_tables\ -I                       #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\component\audio_rx\ -I                           #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\component\edid_tx\ -I                            #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\component\debugger_hdmigear\ -I                  #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\component\cbus\ -I C:\Users\tony.tsou\Desktop\Am #
#                    TRAN\Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\. #
#                    .\..\Libraries\AMT_Drivers\sii953x\component\rtpi\ -I    #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\component\cdc\ -I C:\Users\tony.tsou\Desktop\AmT #
#                    RAN\Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\.. #
#                    \..\Libraries\AMT_Drivers\sii953x\component\cec_manager\ #
#                     -I C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\Dev #
#                    Code\2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Driv #
#                    ers\sii953x\component\thx\ -I                            #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\component\ipv\ -I C:\Users\tony.tsou\Desktop\AmT #
#                    RAN\Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\.. #
#                    \..\Libraries\AMT_Drivers\sii953x\component\osd\ -I      #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\component\cec_switch\ -I                         #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\component\cec_system_audio_control\ -I           #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\driver\ -I C:\Users\tony.tsou\Desktop\AmTRAN\Pro #
#                    jects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\..\..\Lib #
#                    raries\AMT_Drivers\sii953x\driver\audio_mix_drv\ -I      #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\driver\sii953x_drv\ -I                           #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\driver\cra_drv\ -I C:\Users\tony.tsou\Desktop\Am #
#                    TRAN\Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\. #
#                    .\..\Libraries\AMT_Drivers\sii953x\driver\matrix_sw_drv\ #
#                     -I C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\Dev #
#                    Code\2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Driv #
#                    ers\sii953x\driver\nvram_sram_drv\ -I                    #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\driver\tpi_drv\ -I C:\Users\tony.tsou\Desktop\Am #
#                    TRAN\Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\. #
#                    .\..\Libraries\AMT_Drivers\sii953x\driver\audio_rx_drv\  #
#                    -I C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevC #
#                    ode\2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drive #
#                    rs\sii953x\driver\repeater_avr_drv\ -I                   #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\driver\gpio_drv\ -I                              #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\driver\tpg_drv\ -I C:\Users\tony.tsou\Desktop\Am #
#                    TRAN\Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\. #
#                    .\..\Libraries\AMT_Drivers\sii953x\driver\cbus_drv\ -I   #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\driver\cpi_drv\ -I C:\Users\tony.tsou\Desktop\Am #
#                    TRAN\Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\. #
#                    .\..\Libraries\AMT_Drivers\sii953x\driver\arc_drv\ -I    #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\driver\osd_drv\ -I C:\Users\tony.tsou\Desktop\Am #
#                    TRAN\Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\. #
#                    .\..\Libraries\AMT_Drivers\sii953x\driver\ipv_drv\ -I    #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\platform\hal\ir_remote\ -I                       #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\platform\hal\eeprom\ -I                          #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\platform\hal\timer\ -I                           #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\platform\hal\i2c\ -I                             #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\platform\osal\timer\ -I                          #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    sii953x\platform\board\ -Ohz -I "C:\Program Files        #
#                    (x86)\IAR Systems\Embedded Workbench                     #
#                    6.0\arm\CMSIS\Include\"                                  #
#    List file    =  C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\Output\S4051A\Application\Li #
#                    st\si_thx_component.lst                                  #
#    Object file  =  C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\Output\S4051A\Application\Ob #
#                    j\si_thx_component.o                                     #
#                                                                             #
#                                                                             #
###############################################################################

C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode\2\Libraries\AMT_Drivers\sii953x\component\thx\si_thx_component.c
      1          //***************************************************************************
      2          //!file     si_thx_component.c
      3          //!brief    Silicon Image THX Component.
      4          //
      5          // No part of this work may be reproduced, modified, distributed,
      6          // transmitted, transcribed, or translated into any language or computer
      7          // format, in any form or by any means without written permission of
      8          // Silicon Image, Inc., 1140 East Arques Avenue, Sunnyvale, California 94085
      9          //
     10          // Copyright 2002-2011, Silicon Image, Inc.  All rights reserved.
     11          //***************************************************************************/
     12          
     13          #include "string.h"
     14          #include "si_drv_internal.h"
     15          #include "si_debug.h"
     16          #include "si_thx_component.h"
     17          
     18          ThxInstanceData_t		thxInst[THX_INSTANCE];
     19          ThxInstanceData_t* 		pThx  = &thxInst[0];
     20          
     21          //------------------------------------------------------------------------------
     22          // Function:    SiiThxInitialize
     23          // Description:
     24          // Returns:     TRUE if no problem
     25          //------------------------------------------------------------------------------
     26          
     27          bool_t SiiThxInitialize ( const uint8_t* pPktHdr, uint8_t thxPktCnt)
     28          {
     29              uint8_t i, j;
     30              memset(pThx, 0, sizeof(ThxInstanceData_t));
     31          
     32              pThx->pktNo = 0;
     33              pThx->thxPktCnt = thxPktCnt;
     34          
     35              for (i = 0; i < thxPktCnt; i++)
     36              {
     37                  DEBUG_PRINT( MSG_ALWAYS, "\nTHX Packet Header[%X]:: ", i );
     38                  for (j = 0; j < THX_PKT_HDR_LEN; j++)
     39                  {
     40                      pThx->thxPktHdrs[i][j] = *pPktHdr;
     41                      pPktHdr++;
     42                      DEBUG_PRINT( MSG_ALWAYS, "%02X ", pThx->thxPktHdrs[i][j] );
     43                  }
     44              }
     45              DEBUG_PRINT( MSG_ALWAYS, "\n" );
     46          
     47              return true;
     48          }
     49          
     50          // figures out if two packets are identical
     51          static bool_t ThxPktsIdentical ( uint8_t* pPkt1, uint8_t* pPkt2 )
     52          {
     53              uint8_t i;
     54          
     55              for (i = 0; i < THX_PKT_LEN - 1; i++)
     56              {
     57                  if (*pPkt1 != *pPkt2)
     58                      return false;
     59                  pPkt1++;
     60                  pPkt2++;
     61              }
     62          
     63              return true;
     64          }
     65          
     66          // figures out if the packet is already there in the queue
     67          static bool_t ThxPktExistsInQueue ( uint8_t* pPkt )
     68          {
     69              uint8_t i;
     70          
     71              for (i = 0; i < NO_PKTS; i++)
     72              {
     73                  if (ThxPktsIdentical(pPkt, pThx->pkts[i]))
     74                  {
     75                      return true;
     76                  }
     77              }
     78              return false;
     79          }
     80          
     81          // inserts the packet in the queue
     82          static void ThxInsertInQueue ( uint8_t* pPkt )
     83          {
     84              uint8_t i, j;
     85              bool_t found;
     86          
     87              found = false;
     88          
     89              for (i = 0; i < NO_PKTS; i++)
     90              {
     91                  // check the last unused byte to signal if its an empty packet
     92                  if (pThx->pkts[i][THX_PKT_LEN - 1] == 0x00)
     93                  {
     94                      found = true;
     95                      break;
     96                  }
     97              }
     98          
     99              if (found)
    100              {
    101                  for (j = 0; j < THX_PKT_LEN - 1; j++)
    102                  {
    103                      pThx->pkts[i][j] = *pPkt;
    104                      pPkt++;
    105                  }
    106          
    107                  pThx->pkts[i][THX_PKT_LEN - 1] = 0x01;
    108              }
    109              else
    110              {
    111                  DEBUG_PRINT( MSG_ALWAYS, "\nTHX:: Queue Full:: \n");
    112              }
    113          }
    114          
    115          // prints the whole queue
    116          static void ThxPrintQueue()
    117          {
    118              uint8_t i, j;
    119          
    120              DEBUG_PRINT( MSG_ALWAYS, "\nPrinting Queue:: \n");
    121              for (i = 0; i < NO_PKTS; i++)
    122              {
    123                  // print only if the packet is non-empty
    124                  if (pThx->pkts[i][THX_PKT_LEN - 1] == 0x01)
    125                  {
    126                      DEBUG_PRINT( MSG_ALWAYS, "\nPacket[%x][%04s]:: ", i, (pThx->pkts[i][0] == AIF_HDR_FIRST_BYTE) ? "AIF" : "VSIF" );
    127                      for (j = 0; j < THX_PKT_LEN - 1; j++)
    128                      {
    129                          DEBUG_PRINT( MSG_ALWAYS, "%02X ", pThx->pkts[i][j] );
    130                      }
    131                  }
    132              }
    133              DEBUG_PRINT( MSG_ALWAYS, "\n\n" );
    134          }
    135          
    136          // print a packet including what kind of packet it is
    137          static void ThxPrintPkt( uint8_t* pPkt )
    138          {
    139              uint8_t i;
    140          
    141              DEBUG_PRINT( MSG_ALWAYS, "\nPrinting New Packet:: \n");
    142              for (i = 0; i < THX_PKT_LEN - 1; i++)
    143              {
    144                  DEBUG_PRINT( MSG_ALWAYS, " %02X", *pPkt );
    145                  pPkt++;
    146              }
    147              DEBUG_PRINT( MSG_ALWAYS, "\n\n" );
    148          }
    149          
    150          // figure out if the next packet search is going to be for THX or NON-THX
    151          static uint8_t NextPkt()
    152          {
    153              if (pThx->curPkt == PKT_NON_THX)
    154              {
    155                  pThx->nextPkt = PKT_THX_VSIF;
    156                  pThx->curThxPkt++;
    157              }
    158              else
    159              {
    160                  if (pThx->curThxPkt == pThx->thxPktCnt)
    161                  {
    162                      pThx->nextPkt = PKT_NON_THX;
    163                      pThx->curThxPkt = 0;
    164                  }
    165                  else
    166                  {
    167                      pThx->nextPkt = PKT_THX_VSIF;
    168                      pThx->curThxPkt++;
    169                  }
    170              }
    171          
    172              return pThx->nextPkt;
    173          }
    174          
    175          
    176          //------------------------------------------------------------------------------
    177          // Function:    SiiThxAnalyzePkt
    178          // Description: Analyzes new packet to see if there is any new AIF/VSIF packet has arrived
    179          //------------------------------------------------------------------------------
    180          void SiiThxAnalyzePkt ( void )
    181          {
    182              uint16_t reg, i;
    183              uint8_t pkt[THX_PKT_LEN];
    184          
    185              //DEBUG_PRINT( MSG_ALWAYS, "SiiThxAnalyzePkt() called!! :%02X\n", pThx->curPkt );
    186          
    187              // Read VSIF infoframe
    188          	for (i = 0; i < THX_PKT_LEN - 1; i++)
    189          	{
    190          		reg = REG_RP_VISF_CONTENT_HEADER + i;
    191          		pkt[i] = SiiRegRead(reg);
    192          		//DEBUG_PRINT( MSG_ALWAYS, "reg [%02X]:: %02x \n", reg, pkt[i] );
    193          	}
    194          
    195          	// If VSIF, check to see if it is in our queue
    196          	if (pkt[0] == VSIF_HDR_FIRST_BYTE)
    197          	{
    198          		if (!ThxPktExistsInQueue(&pkt[0]))
    199          		{
    200          			ThxInsertInQueue(&pkt[0]);
    201          			ThxPrintPkt(&pkt[0]);
    202          			DEBUG_PRINT( MSG_ALWAYS, "This packet is a NEW VSIF packet!!\n" );
    203          			ThxPrintQueue();
    204          		}
    205          	}
    206          
    207          	// Now read the AIF buffer infoframe
    208              for (i = 0; i < THX_PKT_LEN - 1; i++)
    209              {
    210                  reg = REG_MP_AIF_CONTENT_HEADER + i;
    211                  pkt[i] = SiiRegRead(reg);
    212                  //DEBUG_PRINT( MSG_ALWAYS, "reg [%02X]:: %02x \n", reg, pkt[i] );
    213              }
    214          
    215              // Check if AIF aor VSIF
    216              if ((pkt[0] == VSIF_HDR_FIRST_BYTE) || (pkt[0] == AIF_HDR_FIRST_BYTE))
    217              {
    218                  if (!ThxPktExistsInQueue(&pkt[0]))
    219                  {
    220                  	ThxInsertInQueue(&pkt[0]);
    221          			ThxPrintPkt(&pkt[0]);
    222          			if (pThx->curPkt == PKT_NON_THX)
    223          			{
    224          				DEBUG_PRINT( MSG_ALWAYS, "This packet is a NEW AIF packet!!\n" );
    225          			}
    226          			else
    227          			{
    228          				DEBUG_PRINT( MSG_ALWAYS, "This packet is a NEW THX VSIF packet!!\n" );
    229          			}
    230          			ThxPrintQueue();
    231                  }
    232              }
    233          
    234              // Alternate AIF buffer between checking for AIF packets and for specific VSIF packets
    235          	if (NextPkt() == PKT_THX_VSIF)
    236          	{
    237          	    // Set up for capturing a specific VSIF packet
    238          		for (i = 0; i < THX_PKT_HDR_LEN; i++)
    239          		{
    240          			SiiRegWrite(REG_VISF_PB1 + i, pThx->thxPktHdrs[pThx->curThxPkt - 1][i]);
    241          			//DEBUG_PRINT( MSG_ALWAYS, "reg [%02X]:: %02x \n", REG_VISF_PB1+i, SiiDeviceRegisterRead(REG_VISF_PB1+i) );
    242          		}
    243          
    244          		// Enable capture of the specific VSIF loaded above
    245          		SiiRegWrite(REG_CLR_PACKET_BUFFER, BIT7 | BIT6 | BIT5 | BIT3);
    246          		//DEBUG_PRINT( MSG_ALWAYS, "\nWriting reg [%02X]:: %02x as the next pkt for search is THX packet!!\n", REG_CLR_PACKET_BUFFER, SiiDeviceRegisterRead(REG_CLR_PACKET_BUFFER) );
    247          	}
    248          	else
    249          	{
    250          	    // Return to normal capture of AIF
    251          		SiiRegWrite(REG_CLR_PACKET_BUFFER, BIT0);
    252          		//DEBUG_PRINT( MSG_ALWAYS, "\nWriting reg [%02X]:: %02x as the next pkt for search is a NON-THX packet!!\n", REG_CLR_PACKET_BUFFER, SiiDeviceRegisterRead(REG_CLR_PACKET_BUFFER) );
    253          	}
    254          
    255              // set the current equal to next packet as when this routine will be called next the then current pkt would be current next packet
    256              pThx->curPkt = pThx->nextPkt;
    257          }
    258          
    259          
    260          

   Maximum stack usage in bytes:

   .cstack Function
   ------- --------
       48  SiiThxAnalyzePkt
             48 -> SiiRegRead
             48 -> SiiRegWrite
             48 -> ThxInsertInQueue
             48 -> ThxPktExistsInQueue
             48 -> ThxPrintQueue
       16  SiiThxInitialize
             16 -> __aeabi_memclr4
       12  ThxInsertInQueue
       16  ThxPktExistsInQueue
        0  ThxPrintQueue


   Section sizes:

   Bytes  Function/Label
   -----  --------------
       4  ??DataTable3
     220  SiiThxAnalyzePkt
      62  SiiThxInitialize
      58  ThxInsertInQueue
      52  ThxPktExistsInQueue
      10  ThxPrintQueue
       4  pThx
     156  thxInst

 
 156 bytes in section .bss
   4 bytes in section .data
 406 bytes in section .text
 
 406 bytes of CODE memory
 160 bytes of DATA memory

Errors: none
Warnings: 1
