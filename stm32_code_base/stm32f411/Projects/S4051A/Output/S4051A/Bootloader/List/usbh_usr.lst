###############################################################################
#                                                                             #
# IAR ANSI C/C++ Compiler V6.30.1.53127/W32 for ARM     10/Nov/2014  15:19:46 #
# Copyright 1999-2011 IAR Systems AB.                                         #
#                                                                             #
#    Cpu mode     =  thumb                                                    #
#    Endian       =  little                                                   #
#    Source file  =  C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\STM32_IAP\src\usbh_usr.c                     #
#    Command line =  C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\STM32_IAP\src\usbh_usr.c -D                  #
#                    __ARM_CORTEX_MX__ -D DEBUG -D FREE_RTOS -D               #
#                    STM32F40_41xxx -D USE_STM324xG_EVAL -D                   #
#                    USE_STDPERIPH_DRIVER -D HOST_MODE_ENABLED -D             #
#                    IAR_ARM_CM4F -D USE_USB_OTG_FS -D STM32_IAP -D S4051A    #
#                    -lcN C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\De #
#                    vCode\2\Projects\S4051A\EWARM\..\Output\S4051A\Bootloade #
#                    r\List\ -o C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15 #
#                    _K2\DevCode\2\Projects\S4051A\EWARM\..\Output\S4051A\Boo #
#                    tloader\Obj\ --debug --endian=little --cpu=Cortex-M4 -e  #
#                    --fpu=VFPv4_sp --dlib_config "C:\Program Files           #
#                    (x86)\IAR Systems\Embedded Workbench                     #
#                    6.0\arm\INC\c\DLib_Config_Normal.h" -I                   #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\inc\ -I                         #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Projects\STM32_IAP\inc #
#                    \ -I C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\De #
#                    vCode\2\Projects\S4051A\EWARM\..\..\..\Libraries\CMSIS\I #
#                    nclude\ -I C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15 #
#                    _K2\DevCode\2\Projects\S4051A\EWARM\..\..\..\Libraries\C #
#                    MSIS\Device\ST\STM32F4xx\Include\ -I                     #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\STM32F4xx_St #
#                    dPeriph_Driver\inc\ -I C:\Users\tony.tsou\Desktop\AmTRAN #
#                    \Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\..\.. #
#                    \Libraries\FreeRTOS\Source\portable\IAR\ARM_CM4F\ -I     #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\FreeRTOS\Sou #
#                    rce\include\ -I C:\Users\tony.tsou\Desktop\AmTRAN\Projec #
#                    ts\15_K2\DevCode\2\Projects\S4051A\EWARM\..\..\..\Librar #
#                    ies\FreeRTOS\Source\ -I C:\Users\tony.tsou\Desktop\AmTRA #
#                    N\Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\..\. #
#                    .\Libraries\STM32_USB_OTG_Driver\inc\ -I                 #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\STM32_USB_HO #
#                    ST_Library\Core\inc\ -I C:\Users\tony.tsou\Desktop\AmTRA #
#                    N\Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\..\. #
#                    .\Libraries\STM32_USB_HOST_Library\Class\MSC\inc\ -I     #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Libraries\AMT_Drivers\ #
#                    EXT_FLASH\ -I C:\Users\tony.tsou\Desktop\AmTRAN\Projects #
#                    \15_K2\DevCode\2\Projects\S4051A\EWARM\..\..\..\Librarie #
#                    s\AMT_Drivers\HT68F30\ -I C:\Users\tony.tsou\Desktop\AmT #
#                    RAN\Projects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\.. #
#                    \..\Utilities\Third_Party\efsl\inc\ -I                   #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Utilities\Third_Party\ #
#                    fat_fs\inc\ -I C:\Users\tony.tsou\Desktop\AmTRAN\Project #
#                    s\15_K2\DevCode\2\Projects\S4051A\EWARM\..\..\..\Utiliti #
#                    es\mainstream_v1\stm32f411\ -I                           #
#                    C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\..\..\Utilities\mainstream_v #
#                    1\stm32f411\it\ -I C:\Users\tony.tsou\Desktop\AmTRAN\Pro #
#                    jects\15_K2\DevCode\2\Projects\S4051A\EWARM\..\APP_SRC\I #
#                    nclude\ -I C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15 #
#                    _K2\DevCode\2\Projects\S4051A\EWARM\..\APP_SRC\ -Ohz -I  #
#                    "C:\Program Files (x86)\IAR Systems\Embedded Workbench   #
#                    6.0\arm\CMSIS\Include\"                                  #
#    List file    =  C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\Output\S4051A\Bootloader\Lis #
#                    t\usbh_usr.lst                                           #
#    Object file  =  C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode #
#                    \2\Projects\S4051A\EWARM\..\Output\S4051A\Bootloader\Obj #
#                    \usbh_usr.o                                              #
#                                                                             #
#                                                                             #
###############################################################################

C:\Users\tony.tsou\Desktop\AmTRAN\Projects\15_K2\DevCode\2\Projects\STM32_IAP\src\usbh_usr.c
      1          /**
      2            ******************************************************************************
      3            * @file    usbh_usr.c
      4            * @author  MCD Application Team
      5            * @version V2.1.0
      6            * @date    19-March-2012
      7            * @brief   This file includes the usb host library user callbacks
      8            ******************************************************************************
      9            * @attention
     10            *
     11            * <h2><center>&copy; COPYRIGHT 2012 STMicroelectronics</center></h2>
     12            *
     13            * Licensed under MCD-ST Liberty SW License Agreement V2, (the "License");
     14            * You may not use this file except in compliance with the License.
     15            * You may obtain a copy of the License at:
     16            *
     17            *        http://www.st.com/software_license_agreement_liberty_v2
     18            *
     19            * Unless required by applicable law or agreed to in writing, software 
     20            * distributed under the License is distributed on an "AS IS" BASIS, 
     21            * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     22            * See the License for the specific language governing permissions and
     23            * limitations under the License.
     24            *
     25            ******************************************************************************
     26            */
     27          
     28          /* Includes ------------------------------------------------------------------*/
     29          #include <string.h>
     30          #include "usbh_usr.h"
     31          #include "ff.h"       /* FATFS */
     32          #include "usbh_msc_core.h"
     33          #include "usbh_msc_scsi.h"
     34          #include "usbh_msc_bot.h"
     35          #include "command.h"
     36          
     37          #include "HT68F30.h"
     38          
     39          FATFS fatfs;
     40          extern USB_OTG_CORE_HANDLE          USB_OTG_Core;   //Jerry add
     41          uint8_t USBH_USR_ApplicationState = USH_USR_FS_INIT;
     42          
     43          USBH_Usr_cb_TypeDef USR_cb =
     44          {
     45            USBH_USR_Init,
     46            USBH_USR_DeInit,
     47            USBH_USR_DeviceAttached,
     48            USBH_USR_ResetDevice,
     49            USBH_USR_DeviceDisconnected,
     50            USBH_USR_OverCurrentDetected,
     51            USBH_USR_DeviceSpeedDetected,
     52            USBH_USR_Device_DescAvailable,
     53            USBH_USR_DeviceAddressAssigned,
     54            USBH_USR_Configuration_DescAvailable,
     55            USBH_USR_Manufacturer_String,
     56            USBH_USR_Product_String,
     57            USBH_USR_SerialNum_String,
     58            USBH_USR_EnumerationDone,
     59            USBH_USR_UserInput,
     60            USBH_USR_MSC_Application,
     61            USBH_USR_DeviceNotSupported,
     62            USBH_USR_UnrecoveredError
     63              
     64          };
     65          
     66          EmbeddedFileSystem          efs;
     67          EmbeddedFile                fileR;
     68          DirList                     list;
     69          uint8_t joystick_use = 0x00;
     70          uint8_t lcdLineNo = 0x00;
     71          
     72          
     73          void USBH_USR_IAPInit(void)
     74          {
     75          	//HT68F30_LightBar_PowerIndicator( FALSE); /*smith initiates LED bar:  2013/3/22 implemented*/
     76          }
     77          
     78          void USBH_USR_Init(void)
     79          {
     80              //HT68F30_LightBar_USB_DeviceAttached( FALSE );
     81          }
     82          
     83          void USBH_USR_DeviceAttached(void)
     84          {
     85          	//HT68F30_LightBar_USB_DeviceAttached( TRUE );
     86          }
     87          
     88          void USBH_USR_UnrecoveredError (void)
     89          {
     90          }
     91          
     92          void USBH_USR_DeviceDisconnected (void)
     93          {
     94          	//HT68F30_LightBar_USB_DeviceAttached( FALSE );
     95          }
     96          
     97          void USBH_USR_ResetDevice(void)
     98          {
     99          }
    100          
    101          void USBH_USR_DeviceSpeedDetected(uint8_t DeviceSpeed)
    102          {
    103          
    104          }
    105          
    106          void USBH_USR_Device_DescAvailable(void *DeviceDesc)
    107          {
    108          }
    109          
    110          void USBH_USR_DeviceAddressAssigned(void)
    111          {
    112          }
    113          
    114          void USBH_USR_Configuration_DescAvailable(USBH_CfgDesc_TypeDef * cfgDesc,
    115              USBH_InterfaceDesc_TypeDef *itfDesc,
    116              USBH_EpDesc_TypeDef *epDesc)
    117          {
    118          }
    119          
    120          void USBH_USR_Manufacturer_String(void *ManufacturerString)
    121          {
    122          }
    123          
    124          void USBH_USR_Product_String(void *ProductString)
    125          {
    126          }
    127          
    128          void USBH_USR_SerialNum_String(void *SerialNumString)
    129          {
    130          }
    131          
    132          void USBH_USR_EnumerationDone(void)
    133          {
    134          } 
    135          
    136          void USBH_USR_DeviceNotSupported(void)
    137          {
    138          }
    139          
    140          USBH_USR_Status USBH_USR_UserInput(void)
    141          {
    142            return USBH_USR_RESP_OK;
    143          }  
    144          
    145          void USBH_USR_OverCurrentDetected (void)
    146          {
    147          }
    148          
    149          int USBH_USR_MSC_Application(void)
    150          {
    151              if ( f_mount( 0, &fatfs ) != FR_OK ) 
    152              {
    153                  /* efs initialisation fails*/
    154                  return(-1);
    155          	}
    156          
    157              COMMAND_IAPExecuteApplication();
    158          
    159              return(0);
    160          	
    161          }
    162          
    163          void USBH_USR_DeInit(void)
    164          {
    165            USBH_USR_ApplicationState = USH_USR_FS_INIT;
    166          }
    167          
    168          uint8_t USBH_USR_SelectControlMenu(void)
    169          {
    170          	uint8_t status = DEVICE_DISCONNECT;
    171          
    172          	if (HCD_IsDeviceConnected(&USB_OTG_Core) == 0)
    173          	{
    174          		status = DEVICE_DISCONNECT;
    175          		return status;
    176          	}
    177          
    178          	status = NEXT_DOWNLOAD;
    179          
    180          	/* 0.8 seconds delay */
    181          	USB_OTG_BSP_mDelay(800);
    182          
    183          	return status;
    184          }
    185          
    186          /************************ (C) COPYRIGHT STMicroelectronics *****END OF FILE****/
    187          

   Maximum stack usage in bytes:

   .cstack Function
   ------- --------
        0  USBH_USR_Configuration_DescAvailable
        0  USBH_USR_DeInit
        0  USBH_USR_DeviceAddressAssigned
        0  USBH_USR_DeviceAttached
        0  USBH_USR_DeviceDisconnected
        0  USBH_USR_DeviceNotSupported
        0  USBH_USR_DeviceSpeedDetected
        0  USBH_USR_Device_DescAvailable
        0  USBH_USR_EnumerationDone
        0  USBH_USR_IAPInit
        0  USBH_USR_Init
        8  USBH_USR_MSC_Application
             8 -> COMMAND_IAPExecuteApplication
             8 -> f_mount
        0  USBH_USR_Manufacturer_String
        0  USBH_USR_OverCurrentDetected
        0  USBH_USR_Product_String
        0  USBH_USR_ResetDevice
        8  USBH_USR_SelectControlMenu
             8 -> HCD_IsDeviceConnected
             8 -> USB_OTG_BSP_mDelay
        0  USBH_USR_SerialNum_String
        0  USBH_USR_UnrecoveredError
        0  USBH_USR_UserInput


   Section sizes:

   Bytes  Function/Label
   -----  --------------
       4  ??DataTable2
       4  ??DataTable2_1
       4  ??DataTable2_2
       1  USBH_USR_ApplicationState
       2  USBH_USR_Configuration_DescAvailable
       8  USBH_USR_DeInit
       2  USBH_USR_DeviceAddressAssigned
       2  USBH_USR_DeviceAttached
       2  USBH_USR_DeviceDisconnected
       2  USBH_USR_DeviceNotSupported
       2  USBH_USR_DeviceSpeedDetected
       2  USBH_USR_Device_DescAvailable
       2  USBH_USR_EnumerationDone
       2  USBH_USR_IAPInit
       2  USBH_USR_Init
      26  USBH_USR_MSC_Application
       2  USBH_USR_Manufacturer_String
       2  USBH_USR_OverCurrentDetected
       2  USBH_USR_Product_String
       2  USBH_USR_ResetDevice
      26  USBH_USR_SelectControlMenu
       2  USBH_USR_SerialNum_String
       2  USBH_USR_UnrecoveredError
       4  USBH_USR_UserInput
      72  USR_cb
     692  efs
    1072  fatfs
      80  fileR
       1  joystick_use
       1  lcdLineNo
      52  list

 
 1 899 bytes in section .bss
    72 bytes in section .data
   108 bytes in section .text
 
   108 bytes of CODE memory
 1 971 bytes of DATA memory

Errors: none
Warnings: none
